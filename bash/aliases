# all-purpose aliases
alias h="cd ~"
alias c="clear"
alias hc="cd ~ && clear"
alias ll="ls -lhF"
alias lla="ls -lAhF"
alias ..="cd .."
alias df="source ~/.bash_profile"
alias mdf="mate ~/bin/dotfiles"
alias apache="sudo /usr/sbin/apachectl"
alias dir_size="du -sh"
alias flush_cache="dscacheutil -flushcache"
alias updatedb="sudo /usr/libexec/locate.updatedb"
alias redis="redis-server /usr/local/etc/redis.conf"
alias fixmysql="sudo install_name_tool -change libmysqlclient.18.dylib /usr/local/mysql/lib/libmysqlclient.18.dylib"
alias install_nokogiri="gem install nokogiri -- --with-xml2-lib=/usr/local/lib --with-xml2-include=/usr/local/include/libxml2 --with-xslt-lib=/usr/local/lib --with-xslt-include=/usr/local/include"

# svn
alias up="svn update"
alias st="svn status --quiet --ignore-externals"
alias sta="svn status --ignore-externals"
alias ci="svn commit -m"
alias add="svn add"
alias ignore="svn propedit svn:ignore"
alias add_all="svn st | grep '^\?' | awk '{print \$2}' | xargs svn add"
alias rm_all="svn st | grep '^\!' | awk '{print \$2}' | xargs svn rm"
alias reset="svn st | grep '^\?' | awk '{print \$2}' | xargs rm -rf"
alias svn_delete="find . -type d -name .svn | xargs rm -rf"
alias externals="svn propedit svn:externals"
alias ignore="svn propedit svn:ignore"

# git-svn
alias gs="git-achievements svn"
alias gsr="git-achievements svn rebase"
alias gsd="git-achievements svn dcommit"
alias gsf="git-achievements svn fetch"

# git
alias git="git-achievements"
alias glog="git-achievements log --oneline --all --graph --decorate -n 20"
alias gco="git-achievements checkout"
alias gb="git-achievements branch"

# rails
alias tests="rspec spec -c -f d --drb && cucumber -c -f pretty"
alias dj="script/delayed_job"
alias migrate_both="rake db:migrate && rake db:migrate RAILS_ENV=test"

# cucumber
alias cuke="cucumber -f pretty"

# symfony
alias s="php symfony"
alias scc="php symfony cache:clear"
alias dbuild="php symfony doctrine:build-model && php symfony doctrine:build-form && php symfony doctrine:build-filter && php symfony doctrine:build-sql"

# s3
alias s3="/usr/lib/s3sync/s3cmd.rb"

# rails server (2.x and 3.x)
function ss {
  if [ -e script/rails ]; then
    rails server $@
  else
    script/server $@
  fi
}

# rails console (2.x and 3.x)
function sc {
  if [ -e script/rails ]; then
    rails console $@
  else
    script/console $@
  fi
}

# rails generate (2.x and 3.x)
function sg {
  if [ -e script/rails ]; then
    rails generate $@
  else
    script/generate $@
  fi
}

# scp given path from staging server
function scp_staging() {
  scp staging:$1 ./
}

# Commit pending changes and quote all args as message
function gg() {
  git-achievements commit -am "$*"
}

# get a list of routes (symfony or rails)
function routes() {
  if [ -f symfony ]; then
    # first argument is "application" (only for symfony)
    export app=$1

    # second argument is text to pipe to grep command.
    export grep_text=$2

    if [ ! -n "$app" ]; then
      export app="frontend" # default argument
    fi

    if [ ! -n "$grep_text" ]; then
      php symfony app:routes $app
    else
      php symfony app:routes $app | grep $grep_text
    fi
  else
    # first argument is text to pipe to grep command.
    export grep_text=$1

    if [ ! -n "$grep_text" ]; then
      rake routes
    else
      rake routes | grep $grep_text
    fi
  fi
}

# run migrations (rails or symfony)
function migrate() {
  if [ -f symfony ]; then
    php symfony doctrine:migrate
  else
    rake db:migrate
  fi
}

# run an 'ls' on a svn dir
function sls() {
  svn ls http://svn.centresource.com/$1/$2
}

function loggrep() {
  # The first argument is the application (default: frontend)
  export app=$1

  if [ ! -n "$app" ]; then
    export app="frontend"
  fi

  # The second argument is the environment.  (default: dev)
  export env=$2

  if [ ! -n "$env" ]; then
    export env="dev"
  fi

  # The third argument is the grep command.  (default: notice)
  export grep=$3

  if [ ! -n "$grep" ]; then
    export grep="notice"
  fi

  export u="_"
  export file=$app$u$env.log

  echo "tailing $file..."
  echo ""
  tail -f log/$file | grep $grep
}